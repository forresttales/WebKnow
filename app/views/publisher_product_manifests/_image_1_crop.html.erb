<style>

	.input-crop {
		width: 70px;	
	}	
	.preview-1 {
		width: 0px; 
		height: 0px; 
		background-size: 0px 0px;
		background-image: url('<%= @image_1.image_url(:image_600_600) %>'); 
		background-repeat: no-repeat; 
		background-position: 0px 0px; 
		position: relative; 
		margin-left: 0px;
		margin-top: 0px;
		/*border: 1px solid red;*/
	}
	.preview-image-1-375-300-container {
		/*width:375px; 
		height:300px; 
		overflow: hidden;*/
	}	
	
</style>


					<% if !@image_1.nil? %>

						<div style="display: inline-block; width: 608px; height: 1px; margin: 0;"></div>
						<div style="display: inline-block; width: 4px; height: 1px; margin: 0;"></div>
						<div style="display: inline-block; width: 608px; margin: 0;">
							<div class="background-table-dialog-2">
								<div class="dialog-msg-container">
									<span>Preview</span>
								</div>
			   				</div>
						</div>
						<div style="height: 4px;"></div>
						<div style="display: inline-block; width: 604px; height: 604px; background-color: #aaa; border: 2px solid #376340;">
							<img id="cropbox_image_1" alt="" src="<%= @image_1.image_url(:image_600_600) + '?' + (rand(10..90) * rand(100..900)).to_s if @image_1.image? %>" />
						</div>
						<div style="display: inline-block; width: 4px; height: 1px;"></div>
						<div style="display: inline-block; width: 604px; height: auto; vertical-align: top; position: relative;">
			   				<!-- <div style="height: 4px"></div> -->							
							<!-- <div style="width:200px; height:200px; overflow:hidden"> -->

							<div style="width: 375px; height: 300px; position: relative; overflow: hidden; border: 2px solid #376340;">
								<!-- <div style="width: 604px; height: 604px; background-color: #fff; position: relative;"></div> -->
								<div id="preview_1" class="preview-1"></div>
							</div>									

								bgrd<%= text_field_tag :crop_x, params["crop_x"], id: "id_background_size", class: "input-crop" %><br>
							  	x_r<%= text_field_tag :crop_x, params["crop_x"], id: "id_crop_x_image_1_ratio_x", class: "input-crop" %><br>

							  	x<%= text_field_tag :crop_x, params["crop_x"], id: "id_crop_x_image_1", class: "input-crop" %><br>
							  	y<%= text_field_tag :crop_y, params["crop_y"], id: "id_crop_y_image_1", class: "input-crop" %><br>
							  	w<%= text_field_tag :crop_w, params["crop_w"], id: "id_crop_w_image_1", class: "input-crop" %><br>
							  	h<%= text_field_tag :crop_h, params["crop_h"], id: "id_crop_h_image_1", class: "input-crop" %><br>
								<%= hidden_field_tag "image_id_image_1", @image_1.id %>
							
							<% if false %>
			   				<div style="height: 4px"></div>			
			   				<div style="width: 604px; height: 604px; background-color: #ccc; border: 2px solid #376340;">				
								<!-- <div id="preview_image_1_375_300_container" class="preview-image-1-375-300-container"> -->
								  <%= image_tag @image_1.image_url(:image_600_600), :id => "preview_image_1_375_300" %>
								<!-- </div> -->
							</div>
							<% end %>
							
							
			   				<div style="height: 4px"></div>							
							<div style="width:200px; height:200px; overflow: hidden">
							  <%= image_tag @image_1.image_url(:image_600_600), :id => "preview_image_1_200" %>
							</div>
							<div style="height: 4px"></div>
							<div style="width:100px; height:100px; overflow: hidden">
							  <%= image_tag @image_1.image_url(:image_600_600), :id => "preview_image_1_100" %>
							</div>

							<!-- <div style="height: 4px"></div>
							<div id="id_coor_x" style="width:100px; height:20px; overflow:hidden;"></div> -->

							<% if false %>
							<div style="height: 4px"></div>
							<div style="width:50px; height:50px; overflow: hidden">
							  <%= image_tag @image_1.image_url(:image_600_600), :id => "preview_image_1_50" %>
							</div>
							<div style="height: 4px"></div>
							<div style="width:34px; height:34px; overflow: hidden">
							  <%= image_tag @image_1.image_url(:image_600_600), :id => "preview_image_1_34" %>
							</div>
							<% end %>
							<!-- <div style="height: 4px"></div> -->
							<!-- <#%= form_tag( crop_commit_user_publisher_users_path, :remote => true ) do %#> -->

							    <!-- <#%= submit_tag '', :id => 'btn_submit_crop_image_primary', :class => 'hidden' %#> -->
							<!-- <#% end %#> -->	
							
			   				<div style="position: absolute; bottom: -80px; right: 0px;">
								<span><input id="btn_dlg_submit_crop_image_1" class="btn-pop-dialog-1" type="button" value="Save" tabindex=""></span>
								&nbsp;
								<span><input id="btn_dlg_cancel_crop_image_1" class="btn-pop-dialog-1" type="button" value="Cancel" tabindex=""></span>
			   				</div>
							
						</div>
					<% else %>
						<div> no @image_1</div>
					<% end %>		


	<script>
		
		<% if !@image_1.nil? %>
		var insert_crop_x_image_1 = <%= @image_1.crop_x %>;
		var insert_crop_y_image_1 = <%= @image_1.crop_y %>;
		var insert_crop_w_image_1 = <%= @image_1.crop_w %>;
		var insert_crop_h_image_1 = <%= @image_1.crop_h %>;
		<% else %>
		var insert_crop_x_image_1 = 0;
		var insert_crop_y_image_1 = 0;
		var insert_crop_w_image_1 = 200;
		var insert_crop_h_image_1 = 200;		
		<% end %>
				
		var insert_crop_x2_image_1 = insert_crop_x_image_1 + insert_crop_w_image_1;
		var insert_crop_y2_image_1 = insert_crop_y_image_1 + insert_crop_h_image_1;
		
		var background_x = "";
		var background_y = "";

		var coords_w = "";
		var coords_h = "";
		var coords_x = "";
		var coords_y = "";

		var background_size 	= "";
		var background_size_x 	= "";
		var background_size_y 	= "";
		
		var image_width_600 	= 0;
		var image_height_600 	= 0;

		var ratio_width = 0;
		var ratio_height = 0;
		var ratio_image_1 = 0;
		
		var margin_left = "";
		
		var bgrnd_x = 0;
		var bgrnd_y = 0;
		
        function showPreviewImage1(coords)
        {
            if (parseInt(coords.w) > 0)
            {

				// var ratio_width 	= 375 / $('#cropbox_image_1').width();
				// var ratio_height 	= 300 / $('#cropbox_image_1').height();

				image_width_600	 = $('#cropbox_image_1').width();
				image_height_600 = $('#cropbox_image_1').height();

				// var ratio_width 	= Math.round(375 / coords.w);
				// var ratio_height 	= Math.round(300 / coords.h);
				
		    	$('#id_crop_x_image_1').val(coords.x);
		    	$('#id_crop_y_image_1').val(coords.y);
		    	$('#id_crop_w_image_1').val(coords.w);
		    	$('#id_crop_h_image_1').val(coords.h);

				background_position = '-' + Math.round(coords.x) + 'px -' + Math.round(coords.y) + 'px';
				
				if (coords.w > 375) {
					bgrnd_x = image_width_600 * (375/(coords.w * 1.0));
					background_size_x = Math.round(bgrnd_x).toString() + 'px';
					background_size_y = Math.round(bgrnd_x * (image_height_600 / (image_width_600 * 1.0))).toString() + 'px';
					coords_h = Math.round(375 * (coords.h / (coords.w * 1.0))).toString() + 'px';
					coords_w = '375px';
				}
				else if (coords.h > 300){
					bgrnd_y = image_height_600 * (300/(coords.h * 1.0));
					background_size_y = Math.round(bgrnd_y).toString() + 'px';
					background_size_x = Math.round(bgrnd_y * (image_width_600 / (image_height_600 * 1.0))).toString() + 'px';
					coords_w = Math.round(300 * (coords.w / (coords.h * 1.0))).toString() + 'px';
					coords_h = '300px';
				}
				else {
					coords_w = coords.w.toString() + 'px';
					coords_h = coords.h.toString() + 'px';
					background_size_x = $('#cropbox_image_1').width().toString() + 'px';
					background_size_y = $('#cropbox_image_1').height().toString() + 'px'; 
				}

				background_size = background_size_x + ' ' + background_size_y;
				$("#id_background_size").val(background_size);
				
				// background_size = '375px 300px';
				
                // jQuery('#preview_user_200').css({
					// width: Math.round(200 / coords.w * $('#cropbox_user').width()) + 'px',
				    // height: Math.round(200 / coords.h * $('#cropbox_user').height()) + 'px',
				    // marginLeft: '-' + Math.round(200 / coords.w * coords.x) + 'px',
				    // marginTop: '-' + Math.round(200 / coords.h * coords.y) + 'px'
                    // // width: Math.round(rx * 200) + 'px',
                    // // height: Math.round(ry * 200) + 'px',
                    // // marginLeft: '-' + Math.round(rx * coords.x) + 'px',
                    // // marginTop: '-' + Math.round(ry * coords.y) + 'px'
                // });
                jQuery('#preview_1').css({
					width: coords_w,
				    height: coords_h,
				    'background-position':background_position,
				    'background-size':background_size
				    // 'margin-left':margin_left
                });                                
                // jQuery('#preview_1').css({
				    // 'background-position':'10px 20px'
                // });                                
                // jQuery('#preview_image_1_375_300_container').css({
				    // // height: Math.round(coords.h) + 'px'
				    // // height: Math.round(300 / coords.h * $('#cropbox_image_1').height()) + 'px'
				    // // height: Math.round(coords.h * (300 / $('#cropbox_image_1').height())) + 'px'
				    // // height: Math.round(coords.h * (300 / 375)) + 'px'
                // });                
                // jQuery('#preview_image_1_375_300').css({
					// // width: Math.round(375 / coords.w * $('#cropbox_image_1').width()) + 'px',
				    // // height: Math.round(300 / coords.h * $('#cropbox_image_1').height()) + 'px',
// 
					// width: Math.round(coords.w) + 'px',
				    // height: Math.round(coords.h) + 'px',
// 
				    // // marginLeft: '-' + Math.round(coords.x) + 'px',
				    // // marginTop: '-' + Math.round(coords.y) + 'px'
// 
				    // // marginLeft: '-' + Math.round(375 / coords.w * coords.x) + 'px',
				    // // marginTop: '-' + Math.round(300 / coords.h * coords.y) + 'px'
// 
                    // // width: Math.round(rx * 200) + 'px',
                    // // height: Math.round(ry * 200) + 'px',
                    // // marginLeft: '-' + Math.round(rx * coords.x) + 'px',
                    // // marginTop: '-' + Math.round(ry * coords.y) + 'px'
                // });                
                // jQuery('#preview_image_1_375_300').css({
					// // width: Math.round((200 / coords.w) * $('#cropbox_image_1').width()) + 'px',
					// // width: Math.round(600 / coords.w * $('#cropbox_image_1').width()) + 'px',
				    // // height: Math.round(600 / coords.h * $('#cropbox_image_1').height()) + 'px',
					// width: Math.round(coords.w) + 'px',
				    // height: Math.round(coords.h) + 'px',
				    // // marginLeft: '0px',
				    // // marginTop: '0px'
				    // marginLeft: '+' + Math.round(coords.x) + 'px',
				    // marginTop: '+' + Math.round(coords.y) + 'px'
                    // // width: Math.round(rx * 200) + 'px',
                    // // height: Math.round(ry * 200) + 'px',
                    // // marginLeft: '-' + Math.round(rx * coords.x) + 'px',
                    // // marginTop: '-' + Math.round(ry * coords.y) + 'px'
                // });                
                jQuery('#preview_image_1_200').css({
					width: Math.round(200 / coords.w * $('#cropbox_image_1').width()) + 'px',
				    height: Math.round(200 / coords.h * $('#cropbox_image_1').height()) + 'px',
				    marginLeft: '-' + Math.round(200 / coords.w * coords.x) + 'px',
				    marginTop: '-' + Math.round(200 / coords.h * coords.y) + 'px'
                    // width: Math.round(rx * 200) + 'px',
                    // height: Math.round(ry * 200) + 'px',
                    // marginLeft: '-' + Math.round(rx * coords.x) + 'px',
                    // marginTop: '-' + Math.round(ry * coords.y) + 'px'
                });                
                jQuery('#preview_image_1_100').css({
					width: Math.round(100 / coords.w * $('#cropbox_image_1').width()) + 'px',
				    height: Math.round(100 / coords.h * $('#cropbox_image_1').height()) + 'px',
				    marginLeft: '-' + Math.round(100 / coords.w * coords.x) + 'px',
				    marginTop: '-' + Math.round(100 / coords.h * coords.y) + 'px'
                });
                // jQuery('#preview_image_1_50').css({
					// width: Math.round(50 / coords.w * $('#cropbox_image_1').width()) + 'px',
				    // height: Math.round(50 / coords.h * $('#cropbox_image_1').height()) + 'px',
				    // marginLeft: '-' + Math.round(50 / coords.w * coords.x) + 'px',
				    // marginTop: '-' + Math.round(50 / coords.h * coords.y) + 'px'
                // });
                // jQuery('#preview_image_1_34').css({
					// width: Math.round(34 / coords.w * $('#cropbox_image_1').width()) + 'px',
				    // height: Math.round(34 / coords.h * $('#cropbox_image_1').height()) + 'px',
				    // marginLeft: '-' + Math.round(34 / coords.w * coords.x) + 'px',
				    // marginTop: '-' + Math.round(34 / coords.h * coords.y) + 'px'
                // });
                
            }
        }
        
		// jQuery(window).load(function(){
			// jQuery("#cropbox_profile").each(function() {
			  // // image_to_crop = $(this);
			  // image_to_crop = $("#cropbox_profile");
			  // image_to_crop.Jcrop({
	          	// aspectRatio: 1,
	        	// setSelect: [0, 0, 600, 600],
	            // onSelect: function(coords){showPreview(image_to_crop, coords);},
			    // onChange: function(coords){showPreview(image_to_crop, coords);}
			// }
        // });
		
		// jQuery(window).load(function(){
		jQuery(document).ready(function() {
			// coords.x = insert_crop_x;
			// coords.y = insert_crop_y;
			// coords.w = insert_crop_w;
			// coords.h = insert_crop_h;
			
			var image_to_crop = $("#cropbox_image_1");
			image_to_crop.Jcrop({
            // jQuery('#cropbox_profile').Jcrop({
                // aspectRatio: 375/300,
            	// setSelect: [0, 0, 600, 600],
            	setSelect: [insert_crop_x_image_1, insert_crop_y_image_1, insert_crop_x2_image_1, insert_crop_y2_image_1],
            	// setSelect: [ 238, 0, 300, 300 ],
            	
	            // onSelect: function(coords){showPreview(coords);},
			    // onChange: function(coords){showPreview(coords);}
			    
	            // onSelect: function(coords){showPreview(image_to_crop, coords);},
			    // onChange: function(coords){showPreview(image_to_crop, coords);}
                onSelect: showPreviewImage1,
                onChange: showPreviewImage1                
            });
        });
		
		
		// $(window).load( function() {
		$(document).ready(function () {				

			// alert('insert_crop_x : ' + insert_crop_x);
			
			
		});

		
	</script>


