<% provide(:title, 'Products List') %>
<!-- For _publisher_product -->
<script>
	// function set_by_review_listing(b_has_by_review_listing, list_number) {
	// 	var list_id = "#by_review_" + list_number;
	// 	var s = "No";
	// 	// if(b_has_by_review_listing) {
	// 		// s = "Yes"				
	// 	// }
	// 	$(list_id).html(s);
	// }
	
	// function set_field_test(len_col, title, field, field_text, field_text_default, has_field_other, field_other, list_number) {
	// 	var list_id      = "#" + field + "_" + list_number;
	// 	var list_id_text = "#" + field + "_" + list_number + " span.list-field-text";
	// 	var s = "";
	// 	var s_text = "";
	// 	var s_text_default = field_text_default;
	// 	var s_html = "";
	// 	var length_title = title.length + 2;
	// 	var length_column_pixels = len_col;
	// 	var character_size_height = 13;
	// 	var character_size_width = Math.round(13 * 0.50);
	// 	var length_column_characters = Math.round(length_column_pixels/character_size_width);
	// 	var length_allowed = length_column_characters - length_title;
	// 	var length_subtract = 2;
	// 	for(var i = 0; i < field_text.length; i++) {
	// 		s = field_text[i];
	// 		// s = s.replace(/ /g, "&nbsp;");
	// 		if(i == 0) {
	// 				s_text = s;
	// 			}
	// 		if(i > 0) {
	// 				s_text += ', ' + s;
	// 			}
	// 	}
	// 	if(has_field_other) {
	// 		if(s_text.length > 0) {
	// 			s_text += ', ' + field_other;
	// 		}
	// 		else {
	// 			s_text = field_other;
	// 		}
	// 	}
	// 	if(s_text.length > 0) {
	// 		if(s_text.length > length_allowed) {
	// 			s_text = s_text.slice(0, (length_allowed - length_subtract)); 
	//  			s_html += '<span class="list-field-title">' + title + '</span><span class="list-field-text">' + s_text + '</span><span class="list-float-right">...</span>';
	//  			// $(list_id_text).addClass("color-record");
	// 		}
	// 		else {
	//  			s_html += '<span class="list-field-title">' + title + '</span><span class="list-field-text">' + s_text + '</span>';
	//  			// $(list_id_text).addClass("color-record");
	// 		}
	// 	}
	// 	else { 
	// 		s_html += '<span class="list-field-title">' + title + '</span><span class="list-field-text">' + s_text_default + '</span>';
	// 		// $(list_id_text).addClass("color-no-record");
	// 	}
	// 	$(list_id).html(s_html);
	// 	if(s_text.length > 0) {
	// 		$(list_id_text).removeClass("color-no-record").addClass("color-record");
	// 	}
	// 	else { 
	//  		$(list_id_text).removeClass("color-record").addClass("color-no-record");
	// 	}
	// }	
	
	function set_field(title, field, field_text, field_text_default, has_field_other, field_other, list_number) {
		var list_id      = "#" + field + "_" + list_number;
		var list_id_text = "#" + field + "_" + list_number + " span.list-field-text";
		var list_id_ellipsi = "#" + field + "_container_" + list_number + " div.list-field-ellipsi";
		var list_id_tip_span = "#render_" + field + "_" + list_number + " div.list-tip-1 span";
		var list_id_tip = "#render_" + field + "_" + list_number + " div.list-tip-1";
		// alert(list_id_tip);
		var s = "";
		var s_text = "";
		var s_text_default = field_text_default;
		var s_html = "";
		for(var i = 0; i < field_text.length; i++) {
			s = field_text[i];
			// s = s.replace(/ /g, "&nbsp;");
			if(i == 0) {
					s_text = s;
				}
			if(i > 0) {
					s_text += ', ' + s;
				}
		}
		if(has_field_other) {
			if(s_text.length > 0) {
				s_text += ', ' + field_other;
			}
			else {
				s_text = field_other;
			}
		}
		if(s_text.length > 0) {
	 		s_html += '<span class="list-field-title">' + title + '</span><span class="list-field-text">' + s_text + '</span>';
		}
		else { 
			s_html += '<span class="list-field-title">' + title + '</span><span class="list-field-text">' + s_text_default + '</span>';
		}
		$(list_id).html(s_html);
		if(s_text.length > 0) {
			$(list_id_text).removeClass("color-no-record").addClass("color-record");
		}
		else { 
	 		$(list_id_text).removeClass("color-record").addClass("color-no-record");
		}
		
		var w = $(list_id).width();
		if (w > 210) {
			$(list_id).addClass("overflow-hidden-208");
			$(list_id_ellipsi).removeClass("hidden");
			$(list_id_tip_span).html(s_text);
			$(list_id_tip).removeClass("hidden");
		}
	}	
</script>
<!-- End -->
<style>
	.publisher-product-list-span {
	font-family: Arial, Helvetica, sans-serif;
	font-weight: 400;
	color: #666;
	font-size: 14px;		   			
	}
</style>
<style>
	ul.jp-edit-instr {
		margin-bottom:30px;
	}
	ul.jp-edit-instr li {
		font-family: Arial, Helvetica, sans-serif;
		font-size: 18px;
		color: #444;
		width: 500px;
		margin-left: 60px;
		line-height: 1.1em;
		padding-bottom:15px;
	}
</style>
<style>
	.btn-opt-add-spacer {
	display: inline-block; 
	width: 430px;
	}
	.btn-opt-add-container-outer {
	position: relative;
	height: 24px;
	display: inline-block; 
	width: 122px; 
	height: 26px; 
	margin: 2px 0 0 0;		  	
	}
	.btn-opt-add-container {
	background: linear-gradient(#FBB040, #CA8E33);
	border-radius: 10px;
	width: 120px;
	height: 24px;
	}
	.btn-opt-add {
	font-family: Arial, Helvetica, sans-serif;
	font-size: 14px;
	font-weight: 700;		
	color: #eee;
	text-align: center;	
	width: 120px;
	height: 24px;
	padding-top: 4px;
	text-decoration:none;
	outline: none;
	}
	.btn-opt-add:focus {
	}
	.btn-opt-add-container:hover { 
	box-shadow: inset 0 1px 1px rgba(255,255,255,0.1),
	inset 0 1.5em 1em rgba(255,255,255,0.2);
	cursor: pointer;
	}
	.btn-opt-add-container:active .btn-opt-edit { 
	color: transparent;
	text-shadow: 1px 1px #fff;
	}
</style>
<!-- For _publisher_product -->
<style>
	a {
		/*color: transparent;*/
		text-decoration: none;
	}
	a:hover {
		/*color: transparent;*/
		text-decoration: none;
	}
	a:active {
		/*color: transparent;*/
		text-decoration: none;
	}
	a:focus {
		/*color: transparent;*/
		text-decoration: none;
	}		
	</style>
	<style>	
	.container-figure-image-border {
		border: 2px solid #ccc;
	}
	.container-figure-image-list {
		width: 200px;
		height: 200px;	
	}
</style>
<style>
	.color-record {
		/*color: #593E16;*/
		color: #000;
	}	
	.color-no-record {
		color: #49853f;			
	}
	.like-icon {
		height: 22px;
		width: 19px;
		background-image: url("/assets/icon_like_green_w22_h19.png");
		background-repeat: no-repeat;
		background-position: 0px 0px;
		position: relative;
		top: 6px;
	}
	.list-field-title {
		font-family: Arial,Helvetica,sans-serif;
		font-size: 13px;
		font-weight: 700;
		color: #888;
	}
	.list-field-text {
		font-family: Arial,Helvetica,sans-serif;
		font-size: 13px;
		font-weight: 700;
	}
	.list-field-cell-1 {
		display: table-cell; 
		width: 210px;
		overflow-x: hidden;
	}
	.list-field-cell-1a {
		/*width: 208px;*/
		height: 16px;
		width: auto;
		word-wrap: normal;
		white-space: nowrap;
	}
	.list-field-cell-2 {
		display: table-cell; 
		width: 15px;
	}
	.list-field-cell-3 {
		display: table-cell; 
		width: 10px;
	}
	.overflow-hidden-208 {
		width: 208px;
		overflow-x: hidden;
	}
	.hidden {
		display: none !important;
		visibility: hidden !important			
		}
</style>
<style>
	.list-tip-container {
		position: relative;
	}		
	.list-tip-target:hover + .list-tip-1 span {
	}
	.list-tip-target:hover + .list-tip-1 {
		display: block;
	}
	.list-tip-1 {
		position: absolute;
		/*width: 60px;*/
		height: 24px;
		background-color: rgba(0, 0, 0, 0.8);
		border-color: rgba(0, 0, 0, 0.8);
		/*background-color: rgba(55, 99, 58, 0.9);*/ /*#37633A*/
		/*border-color: rgba(55, 99, 58, 0.9);*/			
		border-radius: 3px;
		box-shadow: 0px 2px 2px #aaa;
		text-align: center;			
		font-family:Arial, Helvetica, sans-serif;
		font-size: 13px;
		font-weight: 400;					
		color: #fff;	
		padding: 4px;
		display: none;			
		width: auto;
		word-wrap: normal;
		white-space: nowrap;							
	}
	.list-tip-1-indicator {
		position: absolute;
		top: 24px;
		left: 4px;
		width: 8px;
		height: 12px;
		background-image: url("/assets/drop-w8-h12.png");
	}		
	.list-tip-pos-1 {
		top: -30px;
	}		
</style>
<!-- End -->
<%= form_tag return_profile_users_members_path, :id => 'form_return_profile_users', :remote => true do %>
	<%= hidden_field_tag :profile_user_type %>
	<%= submit_tag 'Submit', id: 'submit_profile_user_hidden', class: 'display-none' %>
<% end %>									
<%= form_tag return_profiles_members_path, :id => 'form_return_profiles', :remote => true do %>
	<%= hidden_field_tag :profile_type %>
	<%= submit_tag 'Submit', id: 'submit_profile_hidden', class: 'display-none' %>
<% end %>									
<div class="table-profile" style="height: 100%;">
	<div class="row-profile">
		<div class="profile-left-col">
			<div class="table margin-0">
				<div class="row">
					<div class="cell-225" style="height: 260px; padding: 0 0 0 1px;">
						<div style="height: 300px; background-color: #dedede;"></div>
					</div>
					<div class="cell-750">
						<div class="post-column">
							<div class="table margin-0">
								<div class="row">
									<div class="cell-100percent">
										<div style="height: 10px;"></div>
										<% if current_user.email == "b@b.com" %>
										<div style="width: 100%; text-align: center;">
											<h5>
												<% delete_all_msg = "Delete all Publisher Product records and reset indices?" %>
												<%= button_to "Delete All Records and Reset Indices", {:action => 'dbdelete'}, :method => :post, data: { confirm: delete_all_msg }, :class => 'reset-db-btn-long' %>
											</h5>
										</div>
										<% end %>
										<div class="line-space-20"></div>
										<h2 style="text-decoration: underline; text-align: center;">Instructions:</h2>
										<ul class="jp-edit-instr">
											<li>1. Click Add Product to add a product to your listing</li>
											<li>2. Then Click on that listing to be taken to its page. From there you can add all the details about this product</li>
											<li>&bull; Each product is added individually. If you need to upload products in bulk, this is a premium service we offer</li>
											<li>&bull; If you need help or have questions, please <a target="_blank" href="http://thelearningcounsel.com/ContactUs" style="color:#49853f;">Contact Us</a></li>
										</ul>
										<div style="height: 10px;"></div>
										<div class="show-story-3">
											<div class="text-align-left">
												<div class="post-user-sub-container" id="sub_container" style="width: 700px;">
													<div style="margin: 0;">
														<div class="publisher-product-utility-bar light">
															<div id="items_count_container" style="color: #eee; font-size: 14px; font-weight: 700; float: left; padding-left: 30px; padding-top: 16px;">
																<span id="items_loaded" style="color: #eee; font-size: 14px; font-weight: 700;"></span> out of <span id="items_count" style="color: #eee; font-size: 14px; font-weight: 700;"><%= @publisher_products_count %></span> items shown
															</div> 
															<div style="float: right; padding-right: 30px; padding-top: 10px;">
																<div class="btn-opt-add-container-outer">
																	<div class="btn-opt-add-container">
																		<div id="btn_add_prod" class="btn-opt-add" tabindex="">
																			Add Product
																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div id="im_top_sh" style="display: block;"></div>
													</div>
													<div id="render_list" style="position: relative;">
														<%= render @publisher_products %>
													</div>
													<div style="height: 10px;"></div>
													<div id="show_more_container" style="text-align: center; font-size: 20px;">
														<div id="show_more" class="btn-opt-add-container-outer">
															<div class="btn-opt-add-container">
																<div class="btn-opt-add" tabindex="">
																	Load more
																</div>
															</div>
														</div>
														<div><%= image_tag('global/loader.gif', alt: 'Loading...', id: 'loader_img', style: 'display: none; height: 26px;') %></div>
													</div>
													<div id="no_more_items" style="display: none; text-align: center;">
														<span style="color: #376340; font-family: Arial, Helvetica, sans-serif; font-size: 16px; font-weight: 700;">No more items!</span>
													</div>											
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="show-story-3">
								<div class="text-align-left">
									<div class="post-user-sub-container" id="sub_container">
										<div id="render_story_4" style="height: auto;"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="cell-225">
						<div style="height: 300px; background-color: #dedede;"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div style="height: 40px;"></div>

<script>
	// $(window).load( function() {
	$(document).ready(function () {				
	
		// $("#render_list").html("<#%= escape_javascript(render("publisher_products/list_full")) %>");

		updateLoadedItemsCount();

		$('#show_more').click(function (e) {		 
	        // prevent the default click action
	        e.preventDefault();	 
	        // hide load more link
	        $('#show_more').hide();	 
	        // show loading gif
	        $('#loader_img').show();
	        // remember current last element
	        var lastElement = $('a.publisher-product-list-span').last(); 
	        // get the last id and save it in a variable 'last-id'
	        var last_id = lastElement.attr('data-id');
	        // count of items you want to load
	        var loadItemsCount = 3; 
	        // make an ajax call passing along our last user id
	        $.ajax({	 
	            // make a get request to the server
	            type: "GET",
	            // get the url from the href attribute of our link
	            url: $(this).attr('href'),
	            // send the last id to our rails app
	            data: {
	                id: last_id,
	                count: loadItemsCount
	            },
	            // the response will be a script
	            dataType: "script",	 
	            // upon success 
	            success: function () {
	                // hide the loading gif
	                $('#loader_img').hide();
	                // show our load more link
	                $('#show_more').show();
	                // focusing on last item
	                // $('html, body').animate({ scrollTop: lastElement.offset().top - 30 }, 500);
	                // updated items count
	                updateLoadedItemsCount();
	            }
	        });	 
	    });

		$('#btn_add_prod').on('click', function() {
		   	$.post("publisher_products/create", null, null, "script");
		});
	
		// $('#publisher_product_utility_bar_footer .pagination a').attr('data-remote', 'true');
	
		// $('#render_record_count span').html("<#%= @publisher_products.count %#>");
	
	
		// $(".chosen-select").chosen({disable_search_threshold: 40});
	
		// $("#select_user").val(1)
		// $('#select_user').trigger('chosen:updated');
	
		
		$("#submit_user_profile").on('click', function() {
			alert('click');
			$("#profile_user_type").val($("#select_user").val());
			$("#submit_profile_user_hidden").click();
		});
	
		$("#submit_profile").on('click', function() {
			var profile_type = $("#select_profile").val();
			// $("#profile_type").val($("#select_profile").val());
			
			switch (profile_type)
			{
			  case '1':
			  	break;
			  case '2':
			  	break;
			  case '3':
					$("#submit_publishers").click();
			  	break;
	
			  default:
			  //
			}			
		});
	
	
		$('.tip').each(function() {
			var tipContent = $(this).next('.tip-content').html();
			$(this).qtip({
				style: { classes: 'tooltip-text-1' },
			  content: tipContent,
			  show: 'mouseover',
			  hide: 'mouseout'
			})
		});			

		$('.tip-bottom-center').each(function() {
			var tipContent = $(this).next('.tip-content').html();
			$(this).qtip({
				style: { classes: 'tooltip-text-1' },
				content: tipContent,
				show: 'mouseover',
				hide: 'mouseout',
				position: {
					my: 'top center',
					at: 'bottom center'
					// target: $('.tip-bottom-center')
				}                    
			})
		});			

		$('.tip-top-center').each(function() {
			var tipContent = $(this).next('.tip-content').html();
			$(this).qtip({
				style: { classes: 'tooltip-text-1' },
				content: tipContent,
				show: 'mouseover',
				hide: 'mouseout',
				position: {
					my: 'bottom center',
					at: 'top center'
					// target: $('.tip-top-center')
				}                    
			})
		});	
	});

	function updateLoadedItemsCount() {
		var loadedItemsCount = 0;

		$("a.publisher-product-list-span").each( function() {
			loadedItemsCount++;
		});

		if (loadedItemsCount > 0) {
			$("#items_count_container").show();
			$("#items_loaded").text(loadedItemsCount);
		} else{
			$("#items_count_container").hide();
		};
	}		 
</script>
<!-- For _publisher_product -->
<script>
	function set_listing_name_product(name_product, b_name_product) {
		if( b_name_product ) {
			$("#listing_name_product").removeClass("color-no-record").addClass("color-record");
		}
		else {
			$("#listing_name_product").removeClass("color-record").addClass("color-no-record");
		}
		$("#listing_name_product").html(name_product);
	}
</script>
<script>
	// *****
	// section listing_product_tagline	
	function set_listing_product_tagline(product_tagline, b_product_tagline) {
		if( b_product_tagline ) {
			$("#listing_product_tagline").removeClass("color-no-record").addClass("color-record");
		}
		else {
			$("#listing_product_tagline").removeClass("color-record").addClass("color-no-record");
		}
		$("#listing_product_tagline").html(product_tagline);
	}
</script>
<!-- End -->